"use strict";window.xdLocalStorage=window.xdLocalStorage||function(){var e,n="cross-domain-local-message",o={iframeId:"cross-domain-iframe",iframeUrl:void 0,initCallback:function(){}},t=-1,i={},a=!1,l=!1;function r(e){var t;try{t=JSON.parse(e.data)}catch(e){}t&&t.namespace===n&&("iframe-ready"===t.id?(l=!0,t.ip&&console.log("xdLocalStorage ip="+t.ip),o.initCallback()):function(e){i[e.id]&&(i[e.id](e),delete i[e.id])}(t))}function s(o,a,l,r){i[++t]=r;var s={namespace:n,etag:0,server:0,id:t,action:o,key:a,value:l};e.contentWindow.postMessage(JSON.stringify(s),"*")}function c(n){o=XdUtils.extend(n,o);var t=document.createElement("div");window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r),t.innerHTML='<iframe id="'+o.iframeId+'" src='+o.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(t),e=document.getElementById(o.iframeId)}function d(){return a?!!l||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return{init:function(e){if(!e.iframeUrl)throw"You must specify iframeUrl";a?console.log("xdLocalStorage was already initialized!"):(a=!0,"complete"===document.readyState?c(e):window.onload=function(){c(e)})},setItem:function(e,n,o){d()&&s("set",e,n,o)},getItem:function(e,n){d()&&s("get",e,null,n)},removeItem:function(e,n){d()&&s("remove",e,null,n)},key:function(e,n){d()&&s("key",e,null,n)},getSize:function(e){d()&&s("size",null,null,e)},getLength:function(e){d()&&s("length",null,null,e)},clear:function(e){d()&&s("clear",null,null,e)},wasInit:function(){return a}}}(),window.xdLocalStorageHA=window.xdLocalStorageHA||function(){var e="cross-domain-local-message",n={iframeId:"cross-domain-iframe",iframeUrls:void 0,initCallback:function(){}},o=-1,t=[],i=[],a=0,l={},r=[],s=!1,c=!1;function d(n){var o;try{o=JSON.parse(n.data)}catch(e){}o&&o.namespace===e&&("iframe-ready"===o.id?o.ip&&console.log("xdLocalStorage ip="+o.ip):"ping"===o.action?(i[o.server]=!0,a++,console.log("XDLS ping reply server="+o.server+" seen_ct="+a)):r[o.server]=o)}function u(n,a,s,c){l[++o]=c;for(var d={namespace:e,etag:Date.now(),id:o,action:n,key:a,value:s},u=0;u<t.length;u++)("ping"==n||i[u])&&(console.log("XDLS request id="+o+" server="+u+" action="+n+" etag="+d.etag),d.server=u,r[u]=null,t[u].contentWindow.postMessage(JSON.stringify(d),"*"));"ping"!=n&&setTimeout(function(){for(var e=-1,n=-1,o=0;o<t.length;o++){var i=r[o];if(null!=i){var a=i.etag?i.etag:0;console.log("XDLS response id="+i.id+" server="+i.server+" etag="+a),a>e&&(e=a,n=o)}}-1!=n?function(e){console.log("XDLS result id="+e.id+" server="+e.server),console.log(e),l[e.id]&&(l[e.id](e),delete l[e.id])}(r[n]):console.log("XDLS wait longer for response?")},250)}function f(e){n=XdUtils.extend(e,n),window.addEventListener?window.addEventListener("message",d,!1):window.attachEvent("onmessage",d);var o=0;n.iframeUrls.forEach(function(e){var i="id-"+n.iframeId+"-"+o,a=document.createElement("div");w3_add(a,"id-"+n.iframeId),a.innerHTML='<iframe id="'+i+'" src='+e+' style="display: none;"></iframe>',document.body.appendChild(a),t[o]=document.getElementById(i),o++})}function m(){return s?!!c||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return setTimeout(function(){u("ping",null,null,null),setTimeout(function(){console.log("XDLS seen servers="+a),c=!0,n.initCallback()},1e3)},5e3),{init:function(e){if(!e.iframeUrls)throw"You must specify iframeUrls";s?console.log("xdLocalStorage was already initialized!"):(s=!0,"complete"===document.readyState?f(e):window.onload=function(){f(e)})},setItem:function(e,n,o){m()&&u("set",e,n,o)},getItem:function(e,n){m()&&u("get",e,null,n)},removeItem:function(e,n){m()&&u("remove",e,null,n)},key:function(e,n){m()&&u("key",e,null,n)},getSize:function(e){m()&&u("size",null,null,e)},getLength:function(e){m()&&u("length",null,null,e)},clear:function(e){m()&&u("clear",null,null,e)},wasInit:function(){return s}}}();