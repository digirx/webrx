var rx_chans,wf_chans,rx_chan,conn_type,timestamp,gmap,kiwi={loaded_files:{},WSPR_rgrid:"",GPS_fixes:0},WATERFALL_CALIBRATION_DEFAULT=-13,SMETER_CALIBRATION_DEFAULT=-13,try_again="",seriousError=!1,firmware_sel={RX_4_WF_4:0,RX_8_WF_2:1,RX_3_WF_3:2},modes_u={0:"AM",1:"AMN",2:"USB",3:"LSB",4:"CW",5:"CWN",6:"NBFM",7:"IQ"},modes_l={0:"am",1:"amn",2:"usb",3:"lsb",4:"cw",5:"cwn",6:"nbfm",7:"iq"},modes_s={am:0,amn:1,usb:2,lsb:3,cw:4,cwn:5,nbfm:6,iq:7},types={0:"active",1:"watch-list",2:"sub-band",3:"DGPS",4:"special event",5:"interference",6:"masked"},types_s={active:0,watch_list:1,sub_band:2,DGPS:3,special_event:4,interference:5,masked:6},type_colors={0:"cyan",16:"lightPink",32:"aquamarine",48:"lavender",64:"violet",80:"violet",96:"lightGrey"},optbar_prefix_color="w3-text-css-orange",dbgUs=!1,dbgUsFirst=!0;function kiwi_bodyonload(e){if(""!=e)kiwi_serious_error(e);else{initCookie("ident","").startsWith("ZL/KF6VO")&&(dbgUs=!0),"undefined"==(conn_type=html("id-kiwi-container").getAttribute("data-type"))&&(conn_type="kiwi"),console.log("conn_type="+conn_type),w3int_init();var i=new Date;timestamp=i.getTime(),extint.ws="kiwi"==conn_type?owrx_ws_open_snd(kiwi_open_ws_cb,{conn_type:conn_type}):kiwi_ws_open(conn_type,kiwi_open_ws_cb,{conn_type:conn_type})}}function kiwi_open_ws_cb(e){"kiwi"!=e.conn_type&&setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3),seriousError||ext_hasCredential(e.conn_type,kiwi_valpwd1_cb,e)}function kiwi_load_js_polled(e,i){return e.started||(kiwi_load_js(i,function(){e.finished=!0}),e.started=!0,e.finished=!1),e.finished}function kiwi_load_js_dir(e,i,t,o){for(var n=0;n<i.length;n++)i[n]=e+i[n];console.log(i),kiwi_load_js(i,t,o)}function kiwi_load_js(e,i,t){console.log("DYNLOAD START"),e.push("kiwi/kiwi_js_load.js");var o=!1;e.forEach(function(e){if(kiwi.loaded_files[e])console.log("already loaded: "+e);else{if(e.includes("kiwi_js_load.js")){if(!o)return}else kiwi.loaded_files[e]=1,o=!0;var t,n=!1;e.endsWith(".js")||e.includes("/js?key=")?((t=document.createElement("script")).src=e,t.type="text/javascript","kiwi/kiwi_js_load.js"==e&&(t.kiwi_cb=i)):e.endsWith(".css")?((t=document.createElement("link")).rel="stylesheet",t.href=e,t.type="text/css"):n=!0,n?console.log("UNKNOWN FILETYPE "+e):(t.async=!1,document.head.appendChild(t),console.log("loading "+e))}}),console.log("DYNLOAD FINISH"),o?w3_call(t,!0):(w3_call(t,!1),w3_call(i))}function kiwi_ask_pwd(e){console.log("kiwi_ask_pwd chan_no_pwd="+chan_no_pwd+" client_public_ip="+client_public_ip);var i="";e&&chan_no_pwd&&(i="All channels busy that don't require a password ("+chan_no_pwd+"/"+rx_chans+")<br>"),kiwi_url_param(["p","prot","protected"],!0,!1)&&(i="You have requested a password protected channel<br>"),kiwi_show_msg("KiwiSDR: software-defined receiver <br>"+i+"<form name='pform' style='display:inline-block' action='#' onsubmit='ext_valpwd(\""+conn_type+"\", this.pwd.value); return false;'>"+try_again+w3_input('w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|name="pwd" size=40 onclick="this.focus(); this.select()"',"Password:")+"</form>"),document.pform.pwd.focus(),document.pform.pwd.select()}var override_freq,override_mode,override_zoom,override_max_dB,override_min_dB,override_9_10,body_loaded=!1;function kiwi_valpwd1_cb(e,i){if(!seriousError)if(1==e)kiwi_ask_pwd("kiwi"==i.conn_type),try_again="Try again. ";else{if(2==e)return void kiwi_show_msg("Still determining local interface address.<br>Please try reloading page in a few moments.");if(3==e)return void kiwi_show_msg("Admin connections not allowed from this ip address.");if(4==e)return void kiwi_show_msg("No admin password set. Can only connect from same local network as Kiwi.<br>Client ip = "+client_public_ip);if(5==e)return void kiwi_show_msg("Multiple connections from the same ip address not allowed.<br>Client ip = "+client_public_ip);0==e&&("kiwi"==i.conn_type?extint.ws=owrx_ws_open_wf(kiwi_open_ws_cb2,i):kiwi_valpwd2_cb(0,i))}}function kiwi_open_ws_cb2(e){ext_hasCredential(e.conn_type,kiwi_valpwd2_cb,e)}function kiwi_valpwd2_cb(e,i){if(!seriousError)if(kiwi_show_msg(""),body_loaded)console.log("kiwi_valpwd2_cb: body_loaded previously!");else{body_loaded=!0,"kiwi"!=i.conn_type&&(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden");try{kiwi_init(),w3_call(i.conn_type+"_main")}catch(e){console.log("EX: "+e),console.log("kiwi_valpwd2_cb: no interface routine for "+i.conn_type+"?")}}}function kiwi_init(){}function kiwi_xdLocalStorage_init(){if(dbgUs){for(var e=[],i=0;i<5;i++)e[i]=dbgUs&&0==i?"http://kiwi:8073/pkgs/xdLocalStorage/xdLocalStorage-min.html":"http://pub"+i+".kiwisdr.com:8073/pkgs/xdLocalStorage/xdLocalStorage-min.html";xdLocalStorageHA.init({iframeUrls:e,initCallback:function(){console.log("xdLocalStorageHA READY")}})}}function kiwi_get_init_settings(){var e=null==init_frequency?7020:init_frequency;e=ext_get_cfg_param("init.freq",e),init_frequency=override_freq||e;var i=null==init_mode?modes_s.lsb:modes_s[init_mode];i=ext_get_cfg_param("init.mode",i),init_mode=override_mode||modes_l[i];var t=null==init_zoom?0:init_zoom;t=ext_get_cfg_param("init.zoom",t),init_zoom=override_zoom||t;var o=null==init_max_dB?-10:init_max_dB;o=ext_get_cfg_param("init.max_dB",o),init_max_dB=override_max_dB||o;var n=null==init_min_dB?-110:init_min_dB;n=ext_get_cfg_param("init.min_dB",n),init_min_dB=override_min_dB||n,console.log("INIT f="+init_frequency+" m="+init_mode+" z="+init_zoom+" min="+init_min_dB+" max="+init_max_dB),w3_call("init_scale_dB");var r=ext_get_cfg_param("rx_antenna"),s=w3_el("rx-antenna");null!=s&&r&&(s.innerHTML="Antenna: "+decodeURIComponent(r)),kiwi.WSPR_rgrid=ext_get_cfg_param_string("WSPR.grid","")}var cfg={},adm={};function cfg_save_json(e,i){var t;null!=i&&null!=i&&(e.startsWith("adm.")?(t=encodeURIComponent(JSON.stringify(adm)),i.send("SET save_adm="+t)):(t=encodeURIComponent(JSON.stringify(cfg)),i.send("SET save_cfg="+t)))}var server_time_utc,server_time_local,server_time_tzid,server_time_tzname,server_tz,geo={geo:"",json:"",retry:0};function kiwi_geolocate(e){var i=kiwi_isFirefox();if(!(i&&i<=28)){var t;switch(null==e&&(e=(new Date).getSeconds()),e%=3){case 0:t="ipapi.co/json";break;case 1:t="extreme-ip-lookup.com/json";break;case 2:t="get.geojs.io/v1/ip/geo.json"}kiwi_ajax("https://"+t,function(i){void 0===i.AJAX_error?(console.log("GEOLOC "+t),console.log(i),geoloc_json(i)):geo.retry++<=3&&kiwi_geolocate(e+1)},null,5e3)}}function geoloc_json(e){if(null==e.AJAX_error){window.JSON&&window.JSON.stringify?geo.json=JSON.stringify(e):geo.json=e.toString();var i=e.country_name||e.country;"United States"==i&&e.region&&(i=e.region+", USA"),geo.geo="",e.city&&(geo.geo+=e.city),i&&(geo.geo+=(e.city?", ":"")+i),console.log("GEOLOC "+geo.geo)}}function kiwi_geo(){return encodeURIComponent(geo.geo)}function kiwi_geojson(){return encodeURIComponent(geo.json)}var time_display_current=!0;function time_display_cb(e){void 0!==e.tu&&(server_time_utc=e.tu,server_time_local=e.tl,server_time_tzid=decodeURIComponent(e.ti),server_time_tzname=decodeURIComponent(e.tn).replace(/\\/g,"").replace(/_/g," "),server_tz=server_time_tzname,server_time_tzid&&(server_tz+=" ("+server_time_tzid+")"),time_display_started?time_display(time_display_current):(time_display_periodic(),time_display_started=!0))}function time_display(e){if(w3_el("id-time-display-text-inner")){var i=""==server_time_local||"null"==server_time_tzname;w3_el("id-time-display-UTC").innerHTML=server_time_utc||"?",w3_el("id-time-display-local").innerHTML=i?"?":server_time_local,w3_el("id-time-display-tzname").innerHTML=i?"Lat/lon needed for local time":server_tz,w3_el("id-time-display-logo-inner").style.opacity=e?0:1,w3_el("id-time-display-inner").style.opacity=e?1:0}}function time_display_periodic(){time_display(time_display_current),time_display_current^=1,setTimeout(function(){time_display_periodic()},time_display_current?5e4:1e4)}var time_display_prev,time_display_started=!1;function time_display_setup(e){var i;0==e.startsWith("id-")&&(e+="-time-display"),time_display_prev&&(i=w3_el(time_display_prev))&&(i.innerHTML=""),time_display_prev=e,(i=w3_el(e)).innerHTML=w3_div("id-time-display-inner",w3_div("id-time-display-text-inner",w3_inline("",w3_div("id-time-display-UTC"),w3_div("cl-time-display-text-suffix","UTC")),w3_inline("",w3_div("id-time-display-local"),w3_div("cl-time-display-text-suffix","Local")),w3_div("id-time-display-tzname")))+w3_div("id-time-display-logo-inner",w3_div("id-time-display-logo-text","Powered by"),'<a href="http://openwebrx.org/" target="_blank"><img id="id-time-display-logo" src="gfx/openwebrx-top-logo.png" /></a>'),time_display(time_display_current)}function time_display_width(){return 200}function time_display_html(e){return w3_div(e+"-time-display|top:50px; background-color:black; position:relative;")}var perf_status_anim,perf_status_timeout,pref={},pref_default={p:"default-p"};function show_pref(){pref_load(function(){var e=w3_divs("w3-text-css-yellow/w3-tspace-16",w3_div("w3-medium w3-text-aqua","<b>User preferences</b>"),w3_col_percent("",w3_input("","Pref","pref.p",pref.p,"pref_p_cb","something"),30),w3_div("w3-show-inline-block w3-hspace-16",w3_button("","Export","pref_export_btn_cb"),w3_button("","Import","pref_import_btn_cb"),"<b>Status:</b> "+w3_div("id-pref-status w3-show-inline-block w3-snap-back")));extint_panel_hide(),ext_panel_set_name("show_pref"),ext_panel_show(e,null,show_pref_post),ext_set_controls_width_height(1024,250),freqset_select()})}function pref_p_cb(e,i){w3_string_cb(e,i),pref_save()}function pref_refresh_ui(){w3_set_value("pref.p",pref.p)}function pref_status(e,i){var t=w3_el("id-pref-status");if(perf_status_anim)return kiwi_clearTimeout(perf_status_timeout),w3_remove_then_add(t,"w3-fade-out","w3-snap-back"),void setTimeout(function(){perf_status_anim=!1,pref_status(e,i)},1e3);t.style.color=e,t.innerHTML=i,w3_remove_then_add(t,"w3-snap-back","w3-fade-out"),perf_status_anim=!0,perf_status_timeout=setTimeout(function(){t.innerHTML="",w3_remove_then_add(t,"w3-fade-out","w3-snap-back"),perf_status_anim=!1},1500)}function pref_export_btn_cb(e,i){console.log("pref_export_btn_cb"),pref_save(function(){console.log("msg_send pref_export"),msg_send("SET pref_export id="+encodeURIComponent(pref.id)+" pref="+encodeURIComponent(JSON.stringify(pref)))}),pref_status("lime","preferences exported")}function pref_import_btn_cb(e,i){console.log("pref_import_btn_cb");var t=ident_user||"_blank_";msg_send("SET pref_import id="+encodeURIComponent(t))}function pref_import_cb(e,i){var t=decodeURIComponent(e);console.log("pref_import_cb "+t),"null"!=t?(pref=JSON.parse(t),console.log(pref),pref_save(),pref_refresh_ui(),pref_status("lime","preferences successfully imported from RX"+i)):pref_status("yellow","no preferences previously exported")}function pref_load(e){var i=ident_user||"_blank_";xdLocalStorageHA.getItem("pref."+i,function(t){console.log("xdLocalStorage.getItem pref."+i),console.log(t),pref=null==t.value?pref_default:JSON.parse(t.value),console.log(pref),e&&e()})}function pref_save(e){var i=ident_user||"_blank_";pref.id=i;var t=JSON.stringify(pref);xdLocalStorageHA.setItem("pref."+i,t,function(t){console.log("xdLocalStorage.setItem pref."+i),console.log(t),e&&e()})}function show_pref_post(){console.log("show_pref_post")}function show_pref_blur(){console.log("show_pref_blur")}function kiwi_output_msg(e,i,t){var o=w3_el(e);if(o){var n;try{n=decodeURIComponent(t.s)}catch(e){console.log("decodeURIComponent FAIL:"),console.log(t.s),n=t.s}void 0===t.tstr&&(t.tstr="");var r=t.tstr;void 0===t.col&&(t.col=0),t.remove_returns&&(n=n.replace(/\r/g,""));for(var s=0;s<n.length;s++){if(t.process_return_nexttime){var _=r.lastIndexOf("\r");r=-1==_?"":r.substring(0,_+1),t.process_return_nexttime=!1}var a=n.charAt(s);"\r"==a?(t.process_return_nexttime=!0,t.col=0):"\f"==a?(r="",t.col=0):(r+=a,"\n"==a?t.col=0:t.col++,t.col==t.ncol&&(r+="\n",t.col=0))}t.tstr=r;var c=w3_el(i),l=kiwi_isScrolledDown(c);o.innerHTML=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"").replace(/\n/g,"<br>"),w3_contains(c,"w3-scroll-down")&&(!t.scroll_only_at_bottom||t.scroll_only_at_bottom&&l)&&(c.scrollTop=c.scrollHeight)}else console.log("kiwi_output_msg NOT_FOUND id="+e)}function gps_stats_cb(e,i,t,o,n,r){var s=(e?"yes":"pause")+", track "+i+", good "+t+", fixes "+o.toUnits();w3_el_softfail("id-msg-gps").innerHTML="GPS acquire "+s,w3_innerHTML("id-status-gps",w3_text(optbar_prefix_color,"GPS"),w3_text("","acq "+s)),extint_adc_clock_Hz=1e6*n,extint_adc_gps_clock_corr=r,r&&(s=n.toFixed(6)+" ("+r.toUnits()+" avgs)",w3_el_softfail("id-msg-gps").innerHTML+=", ADC clock "+s,w3_innerHTML("id-status-adc","ADC clock: "+s))}function admin_stats_cb(e,i,t,o,n,r){if(null!=e){var s=w3_el("id-msg-errors");if(s&&(s.innerHTML="Stats: "+e.toUnits()+" dropped, "+i.toUnits()+" underruns, "+t.toUnits()+" sequence, "+o.toUnits()+" realtime"),s=w3_el("id-status-dpump-hist")){for(var _="Realtime response histogram: ",a=0;a<n;a++)_+=(a?", ":"")+r[a].toUnits();s.innerHTML=_}}}function kiwi_too_busy(e){kiwi_show_msg("Sorry, the KiwiSDR server is too busy right now ("+e+(e>1?" users":" user")+' max). <br>Please check <a href="https://sdr.hu/?top=kiwi" target="_self">sdr.hu</a> for more KiwiSDR receivers available world-wide.')}function kiwi_ip_limit_pwd_cb(e){console.log("kiwi_ip_limit_pwd_cb pwd="+e),writeCookie("iplimit",encodeURIComponent(e)),window.location.reload(!0)}function kiwi_show_error_ask_exemption(e){kiwi_show_msg(e+='<br><br>If you have an exemption password from the KiwiSDR owner/admin <br> please enter it here: <form name="pform" style="display:inline-block" action="#" onsubmit="kiwi_ip_limit_pwd_cb(this.pinput.value); return false">'+w3_input('w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|name="pinput" size=40 onclick="this.focus(); this.select()"',"Password:")+"</form>"),document.pform.pinput.focus(),document.pform.pinput.select()}function kiwi_inactivity_timeout(e){kiwi_show_msg("Sorry, this KiwiSDR has an inactivity timeout after "+e+" minutes.<br>Reload the page to continue.")}function kiwi_24hr_ip_limit(e,i){kiwi_show_error_ask_exemption("Sorry, this KiwiSDR can only be used for "+e+' minutes every 24 hours by each IP address.<br>Please check <a href="https://sdr.hu/?top=kiwi" target="_self">sdr.hu</a> for more KiwiSDR receivers available world-wide.')}function kiwi_up(e){seriousError||(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden")}function kiwi_down(e,i,t){var o;1==(e=+e)?(o='Sorry, software update in progress. Please check back in a few minutes.<br>Or check <a href="https://sdr.hu/?top=kiwi" target="_self">sdr.hu</a> for more KiwiSDR receivers available world-wide.',i>0&&i<9e3?o+="<br>Build: compiling file #"+i:9997==i?o+="<br>Build: linking":9998==i?o+="<br>Build: installing":9999==i&&(o+="<br>Build: done")):2==e?o="Backup in progress.":(null!=t&&""!=t||(t='Sorry, this KiwiSDR server is being used for development right now. <br>Please check <a href="https://sdr.hu/?top=kiwi" target="_self">sdr.hu</a> for more KiwiSDR receivers available world-wide.'),o=t),kiwi_show_msg(o)}var stats_interval=1e4,need_config=!0;function stats_init(){need_config&&(msg_send("SET GET_CONFIG"),need_config=!1),stats_update()}function stats_update(){msg_send("SET STATS_UPD ch="+rx_chan);var e=new Date,i=Math.ceil(e/stats_interval)*stats_interval-e;i<stats_interval/2&&(i+=stats_interval),setTimeout(stats_update,i)}function status_periodic(){w3_innerHTML("id-status-stats-cpu",kiwi_cpu_stats_str),w3_innerHTML("id-status-stats-xfer",kiwi_xfer_stats_str),w3_innerHTML("id-msg-stats-cpu",kiwi_cpu_stats_str_long),w3_innerHTML("id-msg-stats-xfer",kiwi_xfer_stats_str_long)}var kiwi_xfer_stats_str="",kiwi_xfer_stats_str_long="";function xfer_stats_cb(e,i,t,o,n,r){kiwi_xfer_stats_str=w3_text(optbar_prefix_color,"Net")+w3_text("","aud "+e.toFixed(0)+", wf "+i.toFixed(0)+", http "+n.toFixed(0)+", total "+r.toFixed(0)+" kB/s"),kiwi_xfer_stats_str_long="audio "+e.toFixed(0)+" kB/s, waterfall "+i.toFixed(0)+" kB/s ("+t.toFixed(0)+"/"+o.toFixed(0)+" fps), http "+n.toFixed(0)+" kB/s, total "+r.toFixed(0)+" kB/s ("+(8*r).toFixed(0)+" kb/s)"}var kiwi_cpu_stats_str="",kiwi_cpu_stats_str_long="",kiwi_config_str="",kiwi_config_str_long="";function cpu_stats_cb(e,i,t,o,n,r,s){kiwi_cpu_stats_str=w3_text(optbar_prefix_color,"Beagle")+w3_text("",i+"%u "+t+"%s "+o+"%i,")+w3_text(optbar_prefix_color,"FPGA")+w3_text("",n.toFixed(0)+"%")+w3_text(optbar_prefix_color,"FPS")+w3_text("",r.toFixed(0)+"|"+s.toFixed(0)),kiwi_cpu_stats_str_long="Beagle CPU "+i+"% usr / "+t+"% sys / "+o+"% idle, FPGA eCPU "+n.toFixed(0)+"%";var _=e,a=Math.trunc(_%60);_=Math.trunc(_/60);var c=Math.trunc(_%60);_=Math.trunc(_/60);var l=Math.trunc(_%24),d=_=Math.trunc(_/24),p=" ";d&&(p+=d+"d:"),p+=l+":"+c.leadingZeros(2)+":"+a.leadingZeros(2),w3_innerHTML("id-status-config",w3_text(optbar_prefix_color,"Up"),w3_text("",p+", "+kiwi_config_str)),p=" | Uptime: ",d&&(p+=d+" "+(d>1?"days":"day")+" "),p+=l+":"+c.leadingZeros(2)+":"+a.leadingZeros(2),w3_innerHTML("id-msg-config",kiwi_config_str_long+p)}function config_str_update(e,i,t,o){kiwi_config_str="v"+t+"."+o+", "+e+" SDR ch, "+i+" GPS ch",w3_innerHTML("id-status-config",kiwi_config_str),kiwi_config_str_long="Config: v"+t+"."+o+", "+e+" SDR channels, "+i+" GPS channels",w3_innerHTML("id-msg-config",kiwi_config_str)}var config_net={};function config_cb(e,i,t,o,n,r,s,_,a,c,l){config_str_update(e,i,c,l);var d=w3_el("id-net-config");d&&(d.innerHTML=w3_div("",w3_col_percent("",w3_div("","Public IP address (outside your firewall/router): "+o+" [port "+n+"]"),50,w3_div("","Ethernet MAC address: "+a.toUpperCase()),30,w3_div("","KiwiSDR serial number: "+t),20),w3_col_percent("",w3_div("","Private IP address (inside your firewall/router): "+r+" [port "+s+"]"),50,w3_div("","Private netmask: /"+_),50)),config_net.pub_ip=o,config_net.pub_port=n,config_net.pvt_ip=o,config_net.pvt_port=s,config_net.mac=a,config_net.serno=t)}function update_cb(e,i,t,o,n,r,s,_,a,c){config_str_update(t,o,n,r);var l,d=w3_el("id-msg-update");d&&(l="Installed version: v"+n+"."+r+", built "+a+" "+c,l+=i?"<br>Update to version v"+ +s+"."+_+" in progress":e?"<br>Update check pending":-1==s?"<br>Error determining the latest version -- check log":n==s&&r==_?"<br>Running most current version":"<br>Available version: v"+s+"."+_,d.innerHTML=l)}var users_interval=2500,user_init=!1;function users_init(e){console.log("users_init #rx="+rx_chans);for(var i=0;i<rx_chans;i++)divlog("RX"+i+': <span id="id-user-'+i+'"></span> '+(e?w3_button("id-user-kick-"+i+" w3-small w3-white w3-border w3-border-red w3-round-large w3-padding-0 w3-padding-LR-8","Kick","status_user_kick_cb",i):""));users_update(),w3_call("users_setup"),user_init=!0}function users_update(){msg_send("SET GET_USERS"),setTimeout(users_update,users_interval)}function user_cb(e){e.forEach(function(e){var i="",t="",o=e.i,n=e.n,r=e.f,s=e.g,_=void 0!==e.a&&""!=e.a?e.a+", ":"",a=e.m,c=e.z,l=e.t,d="";if(e.rt){var p=1==e.rt?" act":" 24h";d=" "+w3_text("w3-text-css-orange|vertical-align:bottom",e.rs+p)}var w=e.e;if(void 0!==n){var u=kiwi_strip_tags(decodeURIComponent(n),"");""!=u&&(u='"'+u+'" ');var f="(null)"==s||""==s?"unknown location":decodeURIComponent(s);f="("+(_=_.replace(/::ffff:/,""))+f+") ";var m,g=(m=((m=r+1e3*cfg.freq_offset)/1e3).toFixed(m>1e8?1:2))+" kHz ",k='<a href="javascript:tune('+(r/1e3).toFixed(2)+","+sq(a)+","+c+');">';""!=w&&(w=decodeURIComponent(w)+" "),i=u+f,t=k+g+a+" z"+c+"</a> "+w+l+d}if(user_init){w3_innerHTML("id-user-"+o,i+t);var b="id-user-kick-"+o;w3_el(b)&&(""!=i?w3_show_inline_block(b):w3_hide(b)),w3_innerHTML("id-optbar-user-"+o,""!=i?i+"<br>"+t:"")}})}var toggle_e={SET:1,SET_URL:2,FROM_COOKIE:4,WRITE_COOKIE:8};function kiwi_toggle(e,i,t,o){var n=null;if(e&toggle_e.SET_URL&&(null!=i||null!=i))n=i;else if(e&toggle_e.FROM_COOKIE&&null!=(n=readCookie(o))){var r=parseFloat(n);isNaN(r)||(n=r)}return null==n&&e&toggle_e.SET&&(n=i),null==n&&(n=t),n}function kiwi_plot_max(e){var i=bi[e];return 1024/(i.samplerate/i.plot_samplerate)}function kiwi_fft_mode(){setmaxdb(-30)}function kiwi_mapPinSymbol(e,i){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:e=e||"red",fillOpacity:1,strokeColor:i=i||"white",strokeWeight:1,scale:1}}var comp_ctr,chan_no_pwd,pref_import_ch,client_public_ip,reason_disabled="",version_maj=-1,version_min=-1,tflags={INACTIVITY:1,WF_SM_CAL:2,WF_SM_CAL2:4},kiwi_output_msg_p={scroll_only_at_bottom:!0,process_return_nexttime:!1};function kiwi_msg(e,i){var t=!0;switch(e[0]){case"version_maj":version_maj=parseInt(e[1]);break;case"version_min":version_min=parseInt(e[1]);break;case"client_public_ip":client_public_ip=e[1].replace(/::ffff:/,""),console.log("client public IP: "+client_public_ip);break;case"badp":console.log("badp="+e[1]),extint_valpwd_cb(parseInt(e[1]));break;case"chan_no_pwd":chan_no_pwd=parseInt(e[1]);break;case"rx_chans":rx_chans=parseInt(e[1]);break;case"wf_chans":wf_chans=parseInt(e[1]);break;case"rx_chan":rx_chan=parseInt(e[1]);break;case"load_cfg":var o=decodeURIComponent(e[1]);cfg=JSON.parse(o);break;case"load_adm":var n=decodeURIComponent(e[1]);adm=JSON.parse(n);break;case"request_dx_update":dx_update();break;case"mkr":dx_label_cb(JSON.parse(e[1]));break;case"user_cb":user_cb(JSON.parse(e[1]));break;case"config_cb":config_cb((r=JSON.parse(e[1])).r,r.g,r.s,r.pu,r.pe,r.pv,r.pi,r.n,r.m,r.v1,r.v2);break;case"update_cb":update_cb((r=JSON.parse(e[1])).p,r.i,r.r,r.g,r.v1,r.v2,r.p1,r.p2,decodeURIComponent(r.d),decodeURIComponent(r.t));break;case"stats_cb":try{var r;null!=(r=JSON.parse(e[1])).ce&&cpu_stats_cb(r.ct,r.cu,r.cs,r.ci,r.ce,r.af,r.at),xfer_stats_cb(r.aa,r.aw,r.af,r.at,r.ah,r.as),extint_srate=r.sr,gps_stats_cb(r.ga,r.gt,r.gg,r.gf,r.gc,r.go),r.gr&&(kiwi.WSPR_rgrid=r.gr,kiwi.GPS_fixes=r.gf),admin_stats_cb(r.ad,r.au,r.ae,r.ar,r.an,r.ap),time_display_cb(r)}catch(i){console.log("<"+e[1]+">"),console.log("kiwi_msg() stats_cb: JSON parse fail"),console.log(i)}break;case"status_msg_text":kiwi_output_msg_p.s=e[1],kiwi_output_msg("id-output-msg","id-output-msg",kiwi_output_msg_p);break;case"status_msg_html":var s=decodeURIComponent(e[1]);w3_innerHTML("id-status-msg",s),w3_innerHTML("id-msg-status",s);break;case"is_admin":extint_isAdmin_cb(e[1]);break;case"authkey_cb":extint_authkey_cb(e[1]);break;case"down":kiwi_down(e[1],comp_ctr,reason_disabled);break;case"too_busy":kiwi_too_busy(parseInt(e[1]));break;case"inactivity_timeout":kiwi_inactivity_timeout(e[1]);break;case"ip_limit":var _=decodeURIComponent(e[1]).split(",");kiwi_24hr_ip_limit(parseInt(_[0]),_[1]);break;case"comp_ctr":comp_ctr=e[1];break;case"reason_disabled":reason_disabled=decodeURIComponent(e[1]);break;case"sample_rate":extint_srate=parseFloat(e[1]);break;case"pref_import_ch":pref_import_ch=+e[1];break;case"pref_import":pref_import_cb(e[1],pref_import_ch);break;case"adc_clk_nom":extint_adc_clock_nom_Hz=+e[1];break;default:t=!1}return t}function kiwi_debug(e){console.log(e),msg_send("SET debug_msg="+encodeURIComponent(e))}function divlog(e,i){void 0!==i&&i&&(e='<span class="class-error">'+e+"</span>"),w3_el_softfail("id-debugdiv").innerHTML+=e+"<br />"}function kiwi_show_msg(e){html("id-kiwi-msg").innerHTML=e,""==e?(w3_hide("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="hidden"):(w3_hide("id-kiwi-container"),w3_show_block("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="scroll")}function kiwi_server_error(e){kiwi_show_msg('Hmm, there seems to be a problem. <br> \tThe server reported the error: <span style="color:red">'+e+"</span> <br> \tPlease <a href=\"javascript:sendmail('pvsslqwChjtjpgq-`ln','server error: "+e+"');\">email us</a> the above message. Thanks!"),seriousError=!0}function kiwi_serious_error(e){kiwi_show_msg(e),seriousError=!0,console.log(e)}function kiwi_trace(e){e&&console.log("console.trace: "+e);try{console.trace()}catch(e){}}